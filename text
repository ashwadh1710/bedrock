log_message "Creating Apache VirtualHost for SSL reverse proxy"

cat <<EOF > /etc/httpd/conf.d/apache_proxy.conf
Listen 443 https

<VirtualHost *:443>
    SSLEngine on
    SSLCertificateFile      $SSL_CERT_PATH
    SSLCertificateKeyFile   $SSL_KEY_PATH
    SSLCACertificateFile    $INTERMEDIATE_CA

    SSLVerifyClient         require
    SSLVerifyDepth          5

    ProxyPreserveHost On
    ProxyPass /api http://127.0.0.1:20443
    ProxyPassReverse /api http://127.0.0.1:20443

    ErrorLog logs/ssl_error.log
    CustomLog logs/ssl_access.log combined
</VirtualHost>
EOF

log_message "Apache VirtualHost configuration written to /etc/httpd/conf.d/apache_proxy.conf"